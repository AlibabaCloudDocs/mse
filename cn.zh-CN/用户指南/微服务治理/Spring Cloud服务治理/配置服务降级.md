---
keyword: [微服务, 服务治理]
---

# 配置服务降级

当您遇到业务高峰期，发现下游的服务提供者遇到性能瓶颈，甚至影响业务时。您可以通过服务降级功能，对部分的服务消费者进行降级操作，让不重要的业务方不进行真实地调用，直接返回Mock的结果，将宝贵的下游服务提供者资源保留给重要的业务调用方使用，从而提升整体服务的稳定性。

开源已有的Sentinel、Hystrix等开源的熔断降级，主要是对不稳定的弱依赖服务调用进行熔断降级，暂时切断不稳定调用，避免局部不稳定因素导致整体的雪崩。熔断降级作为保护自身的手段，通常在服务消费端进行配置。

MSE提供的服务降级能力既支持在服务调用报错时候进行降级，同时也支持在服务调用正常时也开启，这样可以很好地保护服务提供者，将有限的资源更多地分配给关键的服务消费者。

下面以一个示例介绍Spring Cloud服务降级的使用场景。

-   未配置服务降级

    Consumer 1、2和3默认会调用ProductService中productservice服务的所有Path（/getIp、/product/\{id\}和/products）。

    未配置服务降级规则的调用关系如下图所示。

    ![未配置服务降级](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/0472443061/p176014.png)

-   配置服务降级

    可以配置Consumer 1在调用ProductService中productservice服务的/getIp路径时进行降级。**降级策略**选择**返回自定义Json数据**，**生效策略**选择**针对所有请求生效**。则表示着当Consumer 1需要去调用productservice的/getIp时，不需要真实的调用ProductService，而是会主动根据降级规则进行本地Mock。

    配置完服务降级规则的调用关系如下图所示。

    ![已配置服务降级](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/1472443061/p176015.png)


## 创建服务降级规则

1.  登录[MSE管理控制台](https://mse.console.aliyun.com)。

2.  在左侧导航栏选择**微服务治理中心** \> **服务降级**。

3.  在**服务降级**页面单击**创建规则**。

4.  在**创建规则**页面设置服务降级参数，然后单击**确定**。

    ![服务降级规则-spring cloud](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/5196443061/p176046.png)

    **服务降级规则**参数说明如下。

    |参数|描述|
    |--|--|
    |**规则名称**|输入服务降级规则名称，支持大小写字母、数据、下划线（\_）和短划线（-），长度不超过64个字符。|
    |**描述**|输入服务降级规则描述。|
    |**服务提供者应用**|选择提供服务的应用。|
    |**降级服务消费者应用**|选择被调用的降级服务应用。|
    |**服务降级规则列表**|单击**添加服务降级规则**进行添加。|
    |**框架类型**|选择**Spring Cloud**类型框架。|
    |**服务路径**|选择服务应用和Path。|
    |**请求方法**|选择应用的请求方式。|
    |**生效策略**|选择服务降级的生效策略，包括**针对所有请求生效**和**针对异常请求生效**，请根据实际需求进行选择。|
    |**降级策略**|选择服务降级的具体策略，包含**返回Null值**、**返回Exception异常**和**返回自定义Json数据**，请根据实际需求选择。|
    |**默认状态**|规则的启用开关。    -   打开：创建后即启用，默认打开。
    -   关闭：创建后不启用，如果需要启用，请在**服务降级**页面规则的**操作**列单击**开启**规则。 |


服务降级规则配置完成且开启后，请根据实际业务验证服务降级规则是否生效。

服务降级规则创建完成后，您还可以**编辑**规则、根据规则的不同状态**关闭**规则或**开启**规则。当不再需要服务降级时，**删除**规则。

