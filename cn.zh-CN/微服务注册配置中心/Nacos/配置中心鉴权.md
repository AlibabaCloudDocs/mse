# 配置中心鉴权

配置中心鉴权功能可以按照实例、命名空间设置访问权限，降低某个实例被恶意用户非法获取、修改的风险。本文介绍如何在MSE上为Nacos实例配置访问鉴权。

-   [开通MSE](https://www.aliyun.com/product/mse)。
-   [购买并构建Nacos引擎](/cn.zh-CN/快速入门/微服务注册配置中心/购买并构建Nacos引擎.md)。

**说明：** Nacos 1.2.1及以上版本支持配置中心鉴权。

## 开启配置鉴权开关

1.  登录[MSE管理控制台](https://mse.console.aliyun.com)。

2.  在左侧导航栏选择**注册配置中心** \> **实例列表**。

3.  在实例列表页面单击具体实例名称。

4.  在**实例详情**页面左侧菜单栏选择**参数设置**，单击**编辑**。

5.  在ConfigAuthEnabled参数**值**下方选择**是**，然后单击**保存并重启实例**。

    ![开启配置中心鉴权](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1564612161/p237267.png)

    **说明：** 打开配置鉴权开关后，没有配置AccessKey的客户端将无法获取配置，请谨慎操作！


## RAM用户配置鉴权

1.  登录[RAM控制台](https://ram.console.aliyun.com/overview)。

2.  在左侧导航栏单击**RAM角色管理**，单击目标RAM角色名称。

3.  在RAM角色**基本信息**页面选择**信任策略管理**页签，单击**修改信任策略**。

4.  在**修改信任策略**面板中添加读取或修改配置的权限，然后单击**确定**。

    ![RAM用户配置鉴权](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1564612161/p237325.png)

    示例代码如下：

    -   授予RAM用户只能读取配置的权限。

        ```
        {
          "Action": [
            "mse:Get*",
            "mse:List*",
            "mse:Query*",
          ],
          "Resource": [
            "acs:mse:*:*:instance/${instanceId}",
            "acs:mse:*:*:instance/${instanceId}/${namespaceId}"
          ],
          "Effect": "Allow"
        }
        ```

    -   授予RAM用户能读取、修改配置的权限。

        ```
        {
          "Action": [
            "mse:*"
          ],
          "Resource": [
            "acs:mse:*:*:instance/${instanceId}",
            "acs:mse:*:*:instance/${instanceId}/${namespaceId}"
          ],
          "Effect": "Allow"
        }
        ```


## 客户端（SDK）配置鉴权

Nacos实例开启鉴权后，在使用Nacos客户端时，需要添加对应RAM用户的AccessKey ID和AccessKey Secret，否则无法获取配置。

```
properties.put(PropertyKeyConst.ACCESS_KEY, "${accessKey}");
properties.put(PropertyKeyConst.SECRET_KEY, "${secret}");
```

如果AccessKey对应的账号有`mse:QueryNacosConfig`权限，表示可以获取、监听配置。

如果AccessKey对应的账号有`mse:UpdateNacosConfig`权限，表示可以通过SDK修改配置。

示例代码如下：

-   授予用户只能读取配置的权限。

    ```
    {
        "Version": "1",
        "Statement": [
            {
                "Action": [
                    "mse:QueryNacosConfig"
                ],
                "Resource": [
                    "acs:mse:*:*:instance/${instanceId}",
                    "acs:mse:*:*:instance/${instanceId}/${namespaceId}"
                ],
                "Effect": "Allow"
            }
        ]
    }
    ```

-   授予用户能读取、修改配置的权限。

    ```
    {
        "Version": "1",
        "Statement": [
            {
                "Action": [
                    "mse:QueryNacosConfig",
                    "mse:UpdateNacosConfig"
                ],
                "Resource": [
                    "acs:mse:*:*:instance/${instanceId}",
                    "acs:mse:*:*:instance/${instanceId}/${namespaceId}"
                ],
                "Effect": "Allow"
            }
        ]
    }
    ```


