# 添加服务

您需要将已有的服务添加到网关中，登记为API备选服务，以便网关获取服务地址。

添加服务包含两种形式：

-   从注册中心添加：如果在网关中添加了注册中心，网关会从注册中心获取服务列表，将服务列表中的服务及其后端节点地址添加到网关中。
-   从其他来源添加：如果该服务没有注册中心，需要手动添加服务的后端节点地址。

## 操作步骤

1.  登录[微服务网关控制台](https://microgw.console.aliyun.com/)。

2.  在顶部菜单栏选择地域。

3.  在左侧导航栏选择**网关管理**。

4.  在**网关管理**页面单击网关名称。

5.  在**网关详情**页面左侧导航栏单击**服务管理**。

6.  在**服务管理**页面左上角单击**新建服务**。

7.  在**新建服务**对话框中配置服务相关参数，然后单击**确认**。

    ![新建服务](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/7359582161/p84663.png)

    **新建服务**参数说明：

    |参数|说明|
    |--|--|
    |**服务名称**|仅限字母、数字和下划线（\_），最多64个字符，必须以字母开头。|
    |**中文名称**|易于识别的服务中文名称。|
    |**服务来源**|服务的来源，包含**注册中心**和**其他**。其中**其他**表示未在注册中心注册的独立服务。|
    |**注册中心**（适用于来源注册中心的服务）|在网关中添加的注册中心及其地址。|
    |**注册的服务**（适用于来源注册中心的服务）|注册到选定注册中心的服务。|
    |**服务描述**|备注识别服务的信息。|
    |**节点自动刷新**（适用于来源注册中心的服务）|来源为注册中心的服务，建议打开**节点自动刷新**开关。打开后，如果服务的后端节点地址变更，会同步到注册中心，网关可以从注册中心获取该服务最新的后端节点地址。|

    服务创建成功，会弹出：

    ```
    服务创建成功
    ```

    返回**服务管理**页面会查看服务信息。如果包含新建服务的**名称**、**后端节点**和**状态**等信息，则表明服务添加成功。


## 结果验证

服务创建成功后，您可以在控制台直接填写调用参数和发起服务调用请求，并能快速得到服务调用的结果。如果发现请求异常，则根据响应信息排查服务端口、网络或代码的问题。

1.  在服务列表中，选择目标服务，单击**操作**列下的**测试**。

2.  在**测试服务**面板，选择**调用IP**和**请求协议**并填写**测试参数**，然后单击**执行**。

    **说明：** 如果您是第一次使用或者一个小时内未曾使用测试功能，在使用测试功能前，需要初始化测试引擎。待测试引擎初始化完成后，您才可以使用测试功能。

    ![测试服务](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/7290514161/p243087.png)

    |参数|描述|
    |--|--|
    |**调用IP**|要测试的服务实例IP（ECS或Pod）。|
    |**请求协议**|服务调用请求协议，包含**HTTP**和**DUBBO**。请根据实际场景选择请求协议。 |
    |**测试参数**|根据默认模板填写测试参数。    -   选择HTTP协议时：填写path、httpMethod、httpHeaders和params，httpHeaders中填写Content-Type等内容。

本示例仅修改path为实际访问路径/user/rest。

    -   选择DUBBO协议时：填写path、methodName、paramTypes和paramValues。 |

3.  在**测试服务**面板的**结果**区域，查看服务调用返回信息。

    -   调用服务成功：显示调用服务的成功响应信息。例如本示例返回的Hello from \[8080\]!。
    -   调用服务失败：显示调用服务的失败响应信息。请根据响应信息，排查服务的端口、网络及代码本身的问题。

